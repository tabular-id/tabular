# Flathub-style manifest template for Tabular.
# Saat submit ke Flathub, file ini biasanya berada
# di repo khusus flathub (bukan di repo app langsung).

app-id: id.tabular.database
branch: stable
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: tabular

finish-args:
  # GUI & graphics
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri

  # Network access to databases
  - --share=network

  # Allow access to user files (bisa dipersempit nanti)
  - --filesystem=home

  # Optional: access to SSH agent (for tunnels)
  - --socket=ssh-auth

modules:
  - name: tabular
    buildsystem: simple
    build-options:
      env:
        RUSTFLAGS: "-C debuginfo=0 -C opt-level=3"
    build-commands:
      - . /usr/lib/sdk/rust-stable/enable.sh
      - cargo build --release
      - install -Dm755 target/release/tabular /app/bin/tabular
      - install -Dm644 tabular.desktop /app/share/applications/id.tabular.database.desktop
      - sed -i 's|^Exec=.*$|Exec=tabular|' /app/share/applications/id.tabular.database.desktop
      - sed -i 's|^TryExec=.*$|TryExec=tabular|' /app/share/applications/id.tabular.database.desktop || true
      - sed -i 's|^Icon=.*$|Icon=id.tabular.database|' /app/share/applications/id.tabular.database.desktop
      - install -Dm644 assets/logo.png /app/share/icons/hicolor/512x512/apps/id.tabular.database.png
    sources:
      - type: git
        # Ganti URL dan commit/tag di bawah ini sesuai repo kamu
        # misalnya: https://github.com/username/tabular.git
        url: https://github.com/YOUR_USERNAME/YOUR_TABULAR_REPO.git
        branch: main
        # Atau pakai commit/tag spesifik untuk rilis
        # tag: v0.5.27
